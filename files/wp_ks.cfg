#version=DEVEL
url --url="https://mirror.its.sfu.ca/mirror/CentOS/7/os/x86_64/"

eula --agreed

# enable epel-release for yum packages
repo --name="epel" --baseurl=http://download.fedoraproject.org/pub/epel/$releasever/$basearch

# More logs
logging level=debug

# Disable CentOS's First boot screen
firstboot --disable

# Keyboard layout
keyboard --vckeymap=us --xlayouts='us'

lang en_CA.UTF-8


# Reboot after installation
reboot

# Use graphical install
graphical

# Timezone
timezone America/Vancouver --isUtc

# authentication options
auth --passalgo=sha512 --useshadow

# root pass in cryptic
rootpw --iscrypted PEO6a6IsNWw/U


# configure admin user
user --name=admin --password=PEO6a6IsNWw/U --iscrypted --gecos="admin" --groups="wheel"
network --bootproto=dhcp --device=enp0s3 --onboot=on
network --hostname=wp17.lab471.htpbcit.ca
ignoredisk --only-use=sda

clearpart --drives=sda --all 
autopart --type=btrfs

bootloader --append="rhgb crashkernel=auto" --location=mbr 

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

firewall --enabled --http --ssh --service=tftp
selinux --permissive
%packages
@core
python
%end
%post --log=/home/admin/ks-post.log

mkdir /home/admin/.ssh
cat > /home/admin/.ssh/authorized_keys <<-'EOF'
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuA4o4u7TqgUgvkcnzIIm5jlteeIqA++Pv9E75cKyY3z8A9V0tn43VZdLVb+fR452wpbi/UrAXGFiknOkJ3RezItPSR1wo3ZLpLJZeSUXt1xAyqQ9722R2sgVEI6QTcvmfzfPPLbyrqCE8UvdhZFT++ouTWJ7YpYOxXU9P9pn+4K6z7j6EEWhYRgKNhb9wkv8bqcd8ryTuVHWPLbgmMJj818c/oc7pJ6LkqJsL6QsfiOKqSOCgBmzTJNcMglH9eGAXHWR/3558ZlY9FBmyvKFti2n5xU65FuBP975buX+7+cM562ivC8Usj6//lJe4ba1WFjI3iUYGVirbJRXMPzXR achahal@sw08
EOF
chmod 644 /home/admin/.ssh/authorized_keys
yum -y update

#Install Virtualbox Guest Additions
mkdir vbox_cd
mount /dev/sr1 ./vbox_cd
./vbox_cd/VBoxLinuxAdditions.run
umount ./vbox_cd
rmdir ./vbox_cd

#Allow all wheel members to sudo all commands without a password by uncommenting line from /etc/sudoers
sed -i 's/^#\s*\(%wheel\s*ALL=(ALL)\s*NOPASSWD:\s*ALL\)/\1/' /etc/sudoers
#Enable sudo over ssh without a terminal
sed -i 's/^\(Defaults    requiretty\)/#\1/' /etc/sudoers

chmod -R u=rw,g=,o= /home/admin/.ssh
chown -R admin /home/admin/.ssh
chgrp -R admin /home/admin/.ssh
chmod u=rwx,g=,o= /home/admin/.ssh

%end


