#version=DEVEL
url --url="https://mirror.its.sfu.ca/mirror/CentOS/7/os/x86_64/"

eula --agreed

# Add epel-release for required yum packages
repo --name="epel" --baseurl=http://download.fedoraproject.org/pub/epel/$releasever/$basearch

logging level=debug

# Reboot system after Kickstart has ended
reboot

# Disable CentOS's FirstBoot screen
firstboot --disable

keyboard --vckeymap=us --xlayouts='us'

lang en_CA.UTF-8

timezone America/Vancouver --isUtc

# Set up authentication options (Alias of authconfig)
auth --passalgo=sha512 --useshadow

# Set the system's root password from cryptic output
rootpw --iscrypted PEO6a6IsNWw/U

# Specify graphical installation (Default)
graphical

# Create user admin with password set, and added to the group "wheel".
user --name=admin --password=PEO6a6IsNWw/U --iscrypted --gecos="admin" --groups="wheel"

# Set network specifications, DHCP IP from DHCP/(PXE)? Server. "Activate" is the same as "onboot"
network  --bootproto=dhcp --device=eth0 --gateway=192.168.254.1 --ip=192.168.254.5 --nameserver=8.8.8.8 --netmask=255.255.255.0 --ipv6=auto --activate
network  --hostname=wordpress

# Set installer to ignore some disks, useful for autopartitioning
ignoredisk --only-use=sda
clearpart --drives=sda --all 
autopart --type=btrfs

# How boot loader should get installed.
bootloader --append="rhgb crashkernel=auto" --location=mbr #--driveorder=/dev/sda

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end

selinux --permissive

# Install Yum Packages
%packages --nobase --excludedocs
@core
python
%end

%post --nochroot --log=/mnt/sysimage/root/ks-post-nochroot.log 


# Create ssh folder in the admin user's home directory.
mkdir /mnt/sysimage/home/admin/.ssh
cat > /mnt/sysimage/home/admin.ssh/authorized_keys <<EOF
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCuA4o4u7TqgUgvkcnzIIm5jlteeIqA++Pv9E75cKyY3z8A9V0tn43VZdLVb+fR452wpbi/UrAXGFiknOkJ3RezItPSR1wo3ZLpLJZeSUXt1xAyqQ9722R2sgVEI6QTcvmfzfPPLbyrqCE8UvdhZFT++ouTWJ7YpYOxXU9P9pn+4K6z7j6EEWhYRgKNhb9wkv8bqcd8ryTuVHWPLbgmMJj818c/oc7pJ6LkqJsL6QsfiOKqSOCgBmzTJNcMglH9eGAXHWR/3558ZlY9FBmyvKFti2n5xU65FuBP975buX+7+cM562ivC8Usj6//lJe4ba1WFjI3iUYGVirbJRXMPzXR achahal@sw08
EOF
sudo sed -i 's/^#PermitEmptyPasswords no/PermitEmptyPasswords yes/g' /etc/ssh/sshd_config

sudo sed -i 's/#PasswordAuthentication/PasswordAuthentication/g' /etc/ssh/sshd_config

%end

%post --log=/root/ks-post.log
#!/bin/bash
#Update System
yum -y update

sed -i 's/^#\s*\(%wheel\s*ALL=(ALL)\s*NOPASSWD:\s*ALL\)/\1/' /etc/sudoers
sed -i 's/^\(Defaults    requiretty\)/#\1/' /etc/sudoers

# Install Guest Additions
mkdir vbox_cd
mount /dev/sr1 ./vbox_cd
./vbox_cd/VBoxLinuxAdditions.run
umount ./vbox_cd
rmdir ./vbox_cd

 
%end
